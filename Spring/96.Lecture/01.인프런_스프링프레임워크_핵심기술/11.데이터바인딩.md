# 데이터 바인딩

## PropertyEditor

특정
- 공유하고 있는 Value는 Thread Safe하지 않다
   - = 빈으로 등록해서 사용하지 않는다
   - Controller에서 등록해 놓고 사용할 수 있다
   - Object와 String의 관계에서만 된다

PropertyEditor 구현
- 코드
    ~~~java
    public class EventEditor extends PropertyEditorSupport {

        @Override
        public String getAsText() {
            Event event = (Event)getValue();
            return  event.getId().toString();
        }

        @Override
        public void setAsText(String text) throws IllegalArgumentException {
            setValue(new Event(Integer.parseInt(text)));
        }
    }
    ~~~

PropertyEditor를 Controller에 바인딩
- 코드
    ~~~java
    @RestController
    public class EventController {

        @InitBinder
        public void init(WebDataBinder webDataBinder) {
            webDataBinder.registerCustomEditor(Event.class, new EventEditor());
        }

        @GetMapping("/event/{event}")
        public String getEvent(@PathVariable Event event) {
            System.out.println(event);
            return  event.getId().toString();
        }
    }

    ~~~
- EventController가 Get 요청을 처리할 때, InitBinder에 의해서 등록된 바인딩이 있는지 확인한다

## Converter
특징
- PropertyEditor의 단점을 조금 보완하기 위해서 등장. 
- 빈으로 등록할 수 있다

Converter 구현
- 코드
    ~~~java
    public class EventConverter {

        public static class StringToEventConverter implements Converter<String, Event> {

            @Override
            public Event convert(String source) {
                return new Event(Integer.parseInt(source));
            }
        }

        public static class EventToStringConverter implements Converter<Event, String> {

            @Override
            public String convert(Event source) {
                return source.getId().toString();
            }
        }
    }
    ~~~

Converter 등록
- 코드
    ~~~java
    @Configuration
    public class WebConfig implements WebMvcConfigurer {
        @Override
        public void addFormatters(FormatterRegistry registry) {
            registry.addConverter(new EventConverter.StringToEventConverter());
        }
    }
    ~~~

## Formatter
특징
- Locale을 이용해서 값 변경을 지원해줄 수 있다. 이를 MessageSource와 함께 사용하면 다국어 기능 처리가 가능하다
- 빈으로 등록할 수 있다

Formatter 구현
- 코드
    ~~~java
    public class EventFormatter implements Formatter<Event> {

        @Autowired
        MessageSource messageSource;

        @Override
        public Event parse(String text, Locale locale) throws ParseException {
            return new Event(Integer.parseInt(text));
        }

        @Override
        public String print(Event object, Locale locale) {
            return object.getId().toString();
        }
    }
    ~~~

Formmater 등록
- 코드
    ~~~java
    @Configuration
    public class WebConfig implements WebMvcConfigurer {
        @Override
        public void addFormatters(FormatterRegistry registry) {
            registry.addFormatter(new EventFormatter());
        }
    }
    ~~~


## Conversion Service

구조
- WebConversionService
   - DefaultFormattingConversionService
      - ConversionService
      - FormmaterRegistery
         - ConverterRegistry
